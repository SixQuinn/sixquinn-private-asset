<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>ğŸ“Š Six Quinn çš„ç§äººèµ„äº§å·¥å…·</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  padding-top: env(safe-area-inset-top);
  font-size: 18px;
  line-height: 1.55;
}

.container {
  max-width: 420px;
  margin: auto;
  padding: 18px 16px 44px;
}

h1 { font-size: 24px; margin-bottom: 14px; }

.card { background: #020617; border-radius: 14px; padding: 16px; margin-bottom: 16px; }

.card h2 { font-size: 19px; margin: 0 0 10px; }

.row { display: flex; justify-content: space-between; align-items: center; font-size: 16px; margin: 8px 0; }

input {
  width: 120px;
  background: #020617;
  border: 1px solid #334155;
  border-radius: 8px;
  color: #e5e7eb;
  padding: 8px 10px;
  font-size: 17px;
  margin-bottom: 12px;
}

button {
  background: #1e293b;
  border: none;
  color: #e5e7eb;
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 15px;
  cursor: pointer;
}

button:active { opacity: 0.7; }

.progress { background: #020617; border-radius: 8px; overflow: hidden; height: 12px; margin: 10px 0; }
.progress-inner { height: 100%; background: linear-gradient(90deg, #38bdf8, #22c55e); }

.small { font-size: 14px; color: #94a3b8; }

#lock{ position:fixed; inset:0; background:#0f172a; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:999; }
.hidden { display:none; }

canvas { background: #020617; border-radius: 14px; margin-top: 16px; padding: 10px; }
</style>
</head>

<body>

<div id="lock">
  <h2>ğŸ”’ Six Quinn çš„ç§äººèµ„äº§å·¥å…·</h2>
  <p class="small">Local Â· Private Â· Long-term</p>
  <input id="pin" type="password" placeholder="è¾“å…¥ PIN">
  <button onclick="unlock()">è§£é”</button>
  <div id="pinHint" class="small"></div>
</div>

<div class="container hidden" id="app">
  <h1>ğŸ“Š Six Quinn çš„ç§äººèµ„äº§å·¥å…·</h1>

  <div class="card">
    <h2>ğŸ’° èµ„äº§ç»“æ„</h2>
    <div id="assets"></div>
    <button onclick="addCustomAsset()">ï¼‹ æ–°å¢è‡ªå®šä¹‰èµ„äº§</button>
    <canvas id="assetChart" width="350" height="350"></canvas>
  </div>

  <div class="card">
    <h2>ğŸ”‹ æ€»èµ„äº§</h2>
    <div class="row"><span>æ€»èµ„äº§ï¼ˆå…¨éƒ¨ï¼‰</span><strong id="totalAll">0.00</strong></div>
    <div class="row"><span>æ€»èµ„äº§ï¼ˆä¸å«å…¬ç§¯é‡‘ & å…¬å¸è‚¡ç¥¨ï¼‰</span><strong id="totalNoFundStock">0.00</strong></div>
    <div id="level"></div>
    <div class="progress"><div id="levelBar" class="progress-inner"></div></div>
    <div class="small" id="levelGap"></div>
  </div>

  <div class="card">
    <h2>ğŸ“‰ è¢«è£é£é™©ï¼ˆæ— æ”¶å…¥ç”Ÿå­˜æœŸï¼‰</h2>
    <div id="risk"></div>
  </div>

  <div class="card">
    <h2>ğŸ§  èµ„äº§ç»“æ„å»ºè®®</h2>
    <div id="advice" class="small"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const PIN_KEY="SQ_PIN";

const FIXED_ASSETS=[
 {name:"æ”¯ä»˜å®",value:0,fixed:true},
 {name:"äº‘é—ªä»˜",value:0,fixed:true},
 {name:"ç¾å…ƒå¤–æ±‡",value:0,fixed:true},
 {name:"å¹³å®‰è¯åˆ¸",value:0,fixed:true},
 {name:"ä¸œæ–¹è´¢å¯Œ",value:0,fixed:true},
 {name:"å…¬ç§¯é‡‘",value:0,fixed:true},
 {name:"å…¬å¸è‚¡ç¥¨",value:0,fixed:true}
];

let assets=JSON.parse(localStorage.getItem("assets"));
if(!assets){
 assets=FIXED_ASSETS.slice();
 localStorage.setItem("assets",JSON.stringify(assets));
}

let assetChart;

function unlock(){
 const v=document.getElementById("pin").value;
 if(!localStorage.getItem(PIN_KEY)){
   localStorage.setItem(PIN_KEY,v); openApp();
 }else if(v===localStorage.getItem(PIN_KEY)){
   openApp();
 }else document.getElementById("pinHint").innerText="PIN é”™è¯¯";
}

function openApp(){
 document.getElementById("lock").style.display="none";
 document.getElementById("app").classList.remove("hidden");
 renderAssets();
 updateTotals();
}

function save(){
 localStorage.setItem("assets",JSON.stringify(assets));
 updateTotals();
}

function addCustomAsset(){
  const name = prompt("è¯·è¾“å…¥èµ„äº§åç§°");
  if(!name) return;

  assets.push({
    name: name.trim(),
    value: 0,
    fixed: false
  });
  save();
  renderAssets();
}

function removeAsset(i){
 if(assets[i].fixed) return;   // åªè¦æ˜¯ fixed=true æ‰ç¦æ­¢åˆ é™¤
 assets.splice(i,1);
 save();
 renderAssets();
}

function setVal(i,v){
 assets[i].value=parseFloat(v)||0;
 save();
}

function renderAssets(){
  let html="";
  assets.forEach((a,i)=>{
    html+=`<div class="row">
      <span>${a.name} ${a.fixed?"":"ğŸ’¡"}</span>
      <span>
        <input type="number" step="0.01" value="${Number(a.value).toFixed(2)}"
          oninput="setVal(${i},this.value)">
        ${a.fixed?"":"<button onclick='removeAsset(${i})'>ï¼</button>"}
      </span>
    </div>`;
  });
  document.getElementById("assets").innerHTML = html;
}

function updateTotals(){
  let totalAll=0, fund=0, stock=0;
  assets.forEach(a=>{
    totalAll += a.value||0;
    if(a.name==="å…¬ç§¯é‡‘") fund += a.value||0;
    if(a.name==="å…¬å¸è‚¡ç¥¨") stock += a.value||0;
  });

  const totalNoFundStock = totalAll - fund - stock;

  document.getElementById("totalAll").innerText = totalAll.toFixed(2);
  document.getElementById("totalNoFundStock").innerText = totalNoFundStock.toFixed(2);

  const riskYears = totalNoFundStock / 199000;
  const years = Math.floor(riskYears);
  const months = Math.floor((riskYears - years)*12);
  document.getElementById("risk").innerText = `å¯æ”¯æ’‘ ${years} å¹´ ${months} ä¸ªæœˆæ— æ”¶å…¥ç”Ÿå­˜`;

  const levels = [
    {level:"A4",amount:1e3},{level:"A5",amount:1e4},{level:"A6",amount:1e5},{level:"A6.5",amount:5e5},
    {level:"A7",amount:1e6},{level:"A7.5",amount:5e6},{level:"A8",amount:1e7},{level:"A8.5",amount:5e7},
    {level:"A9",amount:1e8},{level:"A10",amount:1e9},{level:"A11",amount:1e10}
  ];
  let currentLevel = levels[0].level;
  for(let i=levels.length-1;i>=0;i--){
    if(totalAll >= levels[i].amount){
      currentLevel = levels[i].level;
      break;
    }
  }
  document.getElementById("level").innerText = `ç­‰çº§ï¼š${currentLevel}`;
  document.getElementById("levelBar").style.width = Math.min(totalAll/1e10*100,100)+"%";
  const nextLevel = levels.find(l=>l.level!==currentLevel && totalAll < l.amount);
  document.getElementById("levelGap").innerText = nextLevel ? `è·ä¸‹ä¸€çº§ï¼š${(nextLevel.amount-totalAll).toFixed(2)}` : "";

  let advice="ç»“æ„ç¨³å¥ã€‚";
  const stockValue = assets.filter(a=>["å¹³å®‰è¯åˆ¸","ä¸œæ–¹è´¢å¯Œ"].includes(a.name)).reduce((sum,a)=>sum+a.value,0);
  if(totalAll>0){
    const stockPct = stockValue/totalAll;
    if(stockPct>=0.5) advice="è‚¡ç¥¨ç±»èµ„äº§å æ¯”è¶…è¿‡ 50%ï¼Œç»“æ„æ³¢åŠ¨æ€§å¾ˆé«˜ï¼Œéœ€é«˜åº¦è­¦æƒ•å¸‚åœºå›æ’¤é£é™©ã€‚";
    else if(stockPct>=0.3) advice="è‚¡ç¥¨ç±»èµ„äº§å æ¯”è¶…è¿‡ 30%ï¼Œå·²æ˜æ˜¾å—è‚¡å¸‚å½±å“ï¼Œå»ºè®®å…³æ³¨å›æ’¤ä¸åˆ†æ•£é…ç½®ã€‚";
    else if(stockPct>=0.2) advice="è‚¡ç¥¨ç±»èµ„äº§å æ¯”è¶…è¿‡ 20%ï¼Œéœ€å¼€å§‹ç•™æ„å¸‚åœºæ³¢åŠ¨å¯¹æ•´ä½“èµ„äº§çš„å½±å“ã€‚";
  }
  document.getElementById("advice").innerText = advice;

  renderChart();
}

function renderChart(){
  const cash = assets.filter(a=>["æ”¯ä»˜å®","äº‘é—ªä»˜","ç¾å…ƒå¤–æ±‡"].includes(a.name)).reduce((s,a)=>s+a.value,0);
  const securities = assets.filter(a=>["å¹³å®‰è¯åˆ¸","ä¸œæ–¹è´¢å¯Œ"].includes(a.name)).reduce((s,a)=>s+a.value,0);
  const fund = assets.filter(a=>a.name==="å…¬ç§¯é‡‘").reduce((s,a)=>s+a.value,0);
  const companyStock = assets.filter(a=>a.name==="å…¬å¸è‚¡ç¥¨").reduce((s,a)=>s+a.value,0);
  const custom = assets.filter(a=>a.fixed !== true).reduce((s,a)=>s+a.value,0);

  const labels = ["æ”¯ä»˜å®ã€äº‘é—ªä»˜ã€ç¾å…ƒå¤–æ±‡","å¹³å®‰è¯åˆ¸ã€ä¸œæ–¹è´¢å¯Œ","å…¬ç§¯é‡‘","å…¬å¸è‚¡ç¥¨"];
  const data = [cash,securities,fund,companyStock];

  if(custom>0){
    labels.push("è‡ªå®šä¹‰èµ„äº§");
    data.push(custom);
  }

  const ctx = document.getElementById("assetChart").getContext("2d");
  if(assetChart) assetChart.destroy();
  assetChart = new Chart(ctx,{
    type:"pie",
    data:{
      labels,
      datasets:[{
        data,
        backgroundColor:["#38bdf8","#22c55e","#facc15","#f87171","#a78bfa"]
      }]
    },
    options:{
      plugins:{
        legend:{position:"bottom",labels:{color:"#e5e7eb"}},
        tooltip:{
          callbacks:{
            label:function(context){
              const total = context.dataset.data.reduce((a,b)=>a+b,0);
              const pct = total ? (context.raw/total*100).toFixed(1) : 0;
              return `${context.label}: ${context.raw.toFixed(2)}ï¼ˆ${pct}%ï¼‰`;
            }
          }
        }
      }
    }
  });
}
</script>
</body>
</html>
