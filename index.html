<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>ğŸ“Š Six Quinn çš„ç§äººèµ„äº§å·¥å…·</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  padding-top: env(safe-area-inset-top);
  font-size: 18px;
}

.container { max-width: 420px; margin: auto; padding: 18px 16px 44px; }
h1 { font-size: 24px; margin-bottom: 14px; }

.card { background: #020617; border-radius: 14px; padding: 16px; margin-bottom: 16px; }
.card h2 { font-size: 19px; margin-bottom: 10px; }

.row {
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:16px;
  margin:8px 0;
}

input {
  width:120px;
  background:#020617;
  border:1px solid #334155;
  border-radius:8px;
  color:#e5e7eb;
  padding:8px 10px;
}

button {
  background:#1e293b;
  border:none;
  color:#e5e7eb;
  border-radius:8px;
  padding:6px 10px;
  cursor:pointer;
}

.small { font-size:14px; color:#94a3b8; }
.hidden { display:none; }
canvas { background:#020617; border-radius:14px; margin-top:12px; }

.tag-btn { margin-left:6px; font-size:14px; }
</style>
</head>

<body>

<div id="lock">
  <h2>ğŸ”’ Six Quinn çš„ç§äººèµ„äº§å·¥å…·</h2>
  <input id="pin" type="password" placeholder="è¾“å…¥ PIN">
  <button onclick="unlock()">è§£é”</button>
</div>

<div class="container hidden" id="app">
  <h1>ğŸ“Š Six Quinn çš„ç§äººèµ„äº§å·¥å…·</h1>

  <div class="card">
    <h2>ğŸ’° èµ„äº§ç»“æ„</h2>
    <div id="assets"></div>
    <button onclick="addCustomAsset()">ï¼‹ æ–°å¢è‡ªå®šä¹‰èµ„äº§</button>
    <button onclick="toggleChartMode()" class="tag-btn">ğŸ“Š åˆ‡æ¢è§†å›¾</button>
    <canvas id="assetChart" width="350" height="350"></canvas>
  </div>

  <div class="card">
    <h2>ğŸ§  èµ„äº§ç»“æ„å»ºè®®</h2>
    <div id="advice" class="small"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const PIN_KEY="SQ_PIN";
let chartMode="group"; // group | detail
let assetChart;

const FIXED_ASSETS=[
 {name:"æ”¯ä»˜å®",value:0,fixed:true},
 {name:"äº‘é—ªä»˜",value:0,fixed:true},
 {name:"ç¾å…ƒå¤–æ±‡",value:0,fixed:true},
 {name:"å¹³å®‰è¯åˆ¸",value:0,fixed:true},
 {name:"ä¸œæ–¹è´¢å¯Œ",value:0,fixed:true},
 {name:"å…¬ç§¯é‡‘",value:0,fixed:true},
 {name:"å…¬å¸è‚¡ç¥¨",value:0,fixed:true}
];

let assets=JSON.parse(localStorage.getItem("assets"));
if(!assets){
 assets=FIXED_ASSETS.slice();
}else{
 // å‘ä¸‹å…¼å®¹è€è‡ªå®šä¹‰èµ„äº§
 assets.forEach(a=>{
   if(a.fixed===false && a.countInStock===undefined){
     a.countInStock=false;
   }
 });
}

function unlock(){
 const v=pin.value;
 if(!localStorage.getItem(PIN_KEY)){
   localStorage.setItem(PIN_KEY,v);
 }
 if(v===localStorage.getItem(PIN_KEY)){
   lock.style.display="none";
   app.classList.remove("hidden");
   renderAll();
 }
}

function save(){
 localStorage.setItem("assets",JSON.stringify(assets));
 renderAll();
}

function addCustomAsset(){
 const name=prompt("è¯·è¾“å…¥èµ„äº§åç§°");
 if(!name) return;
 assets.push({name:name.trim(),value:0,fixed:false,countInStock:false});
 save();
}

function renameAsset(i){
 const name=prompt("ä¿®æ”¹èµ„äº§åç§°",assets[i].name);
 if(name){ assets[i].name=name.trim(); save(); }
}

function toggleStockFlag(i){
 assets[i].countInStock=!assets[i].countInStock;
 save();
}

function removeAsset(i){
 if(!assets[i].fixed){ assets.splice(i,1); save(); }
}

function setVal(i,v){
 assets[i].value=parseFloat(v)||0;
 save();
}

function renderAssets(){
 let html="";
 assets.forEach((a,i)=>{
  html+=`<div class="row">
    <span ondblclick="${a.fixed?"":`renameAsset(${i})`}">
      ${a.name}${a.fixed?"":" âœï¸"}
      ${!a.fixed?`<button class="tag-btn" onclick="toggleStockFlag(${i})">${a.countInStock?"ğŸ“ˆ":"ğŸ’¤"}</button>`:""}
    </span>
    <span>
      <input type="number" value="${a.value}" oninput="setVal(${i},this.value)">
      ${a.fixed?"":`<button onclick="removeAsset(${i})">ï¼</button>`}
    </span>
  </div>`;
 });
 assetsDiv.innerHTML=html;
}

function renderAdvice(){
 let total=assets.reduce((s,a)=>s+a.value,0);
 let stock=assets.filter(a=>
   ["å¹³å®‰è¯åˆ¸","ä¸œæ–¹è´¢å¯Œ"].includes(a.name) ||
   (a.countInStock)
 ).reduce((s,a)=>s+a.value,0);

 let advice="ç»“æ„ç¨³å¥ã€‚";
 if(total>0){
  const p=stock/total;
  if(p>=0.5) advice="è‚¡ç¥¨ç±»èµ„äº§å æ¯” >50%ï¼Œé£é™©æš´éœ²æé«˜ï¼Œéœ€ä¸¥è‚ƒå¯¹å¾…å›æ’¤ã€‚";
  else if(p>=0.3) advice="è‚¡ç¥¨ç±»èµ„äº§å æ¯” >30%ï¼Œèµ„äº§æ³¢åŠ¨æ€§æ˜æ˜¾ã€‚";
  else if(p>=0.2) advice="è‚¡ç¥¨ç±»èµ„äº§å æ¯” >20%ï¼Œå»ºè®®å…³æ³¨å¸‚åœºå‘¨æœŸã€‚";
 }
 adviceDiv.innerText=advice;
}

function toggleChartMode(){
 chartMode = chartMode==="group"?"detail":"group";
 renderChart();
}

function renderChart(){
 if(assetChart) assetChart.destroy();
 let labels=[],data=[];
 if(chartMode==="group"){
   const map={
     "ç°é‡‘":[ "æ”¯ä»˜å®","äº‘é—ªä»˜","ç¾å…ƒå¤–æ±‡" ],
     "è¯åˆ¸":[ "å¹³å®‰è¯åˆ¸","ä¸œæ–¹è´¢å¯Œ" ],
     "å…¬ç§¯é‡‘":[ "å…¬ç§¯é‡‘" ],
     "å…¬å¸è‚¡ç¥¨":[ "å…¬å¸è‚¡ç¥¨" ],
     "è‡ªå®šä¹‰èµ„äº§":[]
   };
   assets.forEach(a=>{
     if(!a.fixed) map["è‡ªå®šä¹‰èµ„äº§"].push(a.name);
   });
   Object.keys(map).forEach(k=>{
     const sum=assets.filter(a=>map[k].includes(a.name)).reduce((s,a)=>s+a.value,0);
     if(sum>0){ labels.push(k); data.push(sum); }
   });
 }else{
   assets.forEach(a=>{
     if(a.value>0){ labels.push(a.name); data.push(a.value); }
   });
 }
 assetChart=new Chart(assetChartEl.getContext("2d"),{
   type:"pie",
   data:{labels,datasets:[{data}]},
   options:{plugins:{legend:{position:"bottom",labels:{color:"#e5e7eb"}}}}
 });
}

function renderAll(){
 renderAssets();
 renderAdvice();
 renderChart();
}

const assetsDiv=document.getElementById("assets");
const adviceDiv=document.getElementById("advice");
const assetChartEl=document.getElementById("assetChart");
</script>
</body>
</html>
