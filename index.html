<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>ğŸ“Š Six Quinn çš„ç§äººèµ„äº§å·¥å…·</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  padding-top: env(safe-area-inset-top);
  font-size: 18px;
  line-height: 1.55;
}

.container {
  max-width: 420px;
  margin: auto;
  padding: 18px 16px 44px;
}

h1 { font-size: 24px; margin-bottom: 14px; }

.card { background: #020617; border-radius: 14px; padding: 16px; margin-bottom: 16px; }

.card h2 { font-size: 19px; margin: 0 0 10px; }

.row { display: flex; justify-content: space-between; align-items: center; font-size: 16px; margin: 8px 0; }

input {
  width: 120px;
  background: #020617;
  border: 1px solid #334155;
  border-radius: 8px;
  color: #e5e7eb;
  padding: 8px 10px;
  font-size: 17px;
  margin-bottom: 16px;
}

button {
  background: #1e293b;
  border: none;
  color: #e5e7eb;
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 15px;
  cursor: pointer;
}

button:active { opacity: 0.7; }

.progress { background: #020617; border-radius: 8px; overflow: hidden; height: 12px; margin: 10px 0; }
.progress-inner { height: 100%; background: linear-gradient(90deg, #38bdf8, #22c55e); }

.small { font-size: 14px; color: #94a3b8; }

#lock, #loading {
  position: fixed;
  inset: 0;
  background: #0f172a;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 999;
}

#lock input, #lock button { margin-bottom: 16px; }

.hidden { display: none; }

canvas { background: #020617; border-radius: 14px; margin-top: 16px; padding: 10px; }

#loading canvas { width: 120px; height: 120px; }

#loading span {
  position: absolute;
  font-size: 36px;
  font-weight: bold;
  color: #38bdf8;
}
</style>
</head>

<body>

<div id="lock">
  <h2>ğŸ”’ Six Quinn çš„ç§äººèµ„äº§å·¥å…·</h2>
  <p class="small">Local Â· Private Â· Long-term</p>
  <input id="pin" type="password" placeholder="è¾“å…¥ PIN">
  <button onclick="unlock()">è§£é”</button>
  <div id="pinHint" class="small"></div>
</div>

<div id="loading" class="hidden">
  <canvas id="circleCountdown" width="120" height="120"></canvas>
  <span id="countNumber">3</span>
  <p class="small" style="margin-top:16px;">æ­£åœ¨åŠ è½½...</p>
</div>

<div class="container hidden" id="app">
  <h1>ğŸ“Š Six Quinn çš„ç§äººèµ„äº§å·¥å…·</h1>

  <div class="card">
    <h2>ğŸ’° èµ„äº§ç»“æ„</h2>
    <div id="assets"></div>
    <button onclick="addCustomAsset()">ï¼‹ æ–°å¢è‡ªå®šä¹‰èµ„äº§</button>
    <canvas id="assetChart" width="350" height="350"></canvas>
  </div>

  <div class="card">
    <h2>ğŸ”‹ æ€»èµ„äº§</h2>
    <div class="row"><span>æ€»èµ„äº§ï¼ˆå…¨éƒ¨ï¼‰</span><strong id="totalAll">0.00</strong></div>
    <div class="row"><span>æ€»èµ„äº§ï¼ˆä¸å«å…¬ç§¯é‡‘ & å…¬å¸è‚¡ç¥¨ï¼‰</span><strong id="totalNoFundStock">0.00</strong></div>
    <div id="level"></div>
    <div class="progress"><div id="levelBar" class="progress-inner"></div></div>
    <div class="progress"><div id="levelGapBar" class="progress-inner" style="background:#facc15;width:0%;"></div></div>
    <div class="small" id="levelGap"></div>
  </div>

  <div class="card">
    <h2>ğŸ“‰ è¢«è£é£é™©ï¼ˆæ— æ”¶å…¥ç”Ÿå­˜æœŸï¼‰</h2>
    <div id="risk"></div>
  </div>

  <div class="card">
    <h2>ğŸ§  èµ„äº§ç»“æ„å»ºè®®</h2>
    <div id="advice" class="small"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const PIN_KEY="SQ_PIN";

const FIXED_ASSETS=[
 {name:"æ”¯ä»˜å®",value:0,fixed:true},
 {name:"äº‘é—ªä»˜",value:0,fixed:true},
 {name:"ç¾å…ƒå¤–æ±‡",value:0,fixed:true},
 {name:"å¹³å®‰è¯åˆ¸",value:0,fixed:true},
 {name:"ä¸œæ–¹è´¢å¯Œ",value:0,fixed:true},
 {name:"å…¬ç§¯é‡‘",value:0,fixed:true},
 {name:"å…¬å¸è‚¡ç¥¨",value:0,fixed:true}
];

let assets=JSON.parse(localStorage.getItem("assets"));
if(!assets){
 assets=FIXED_ASSETS.slice();
 localStorage.setItem("assets",JSON.stringify(assets));
}

let assetChart;

function unlock(){
 const v=document.getElementById("pin").value;
 const pinStored = localStorage.getItem(PIN_KEY);
 if(!pinStored){
   localStorage.setItem(PIN_KEY,v);
   startLoading();
 } else if(v===pinStored){
   startLoading();
 } else document.getElementById("pinHint").innerText="PIN é”™è¯¯";
}

// åœ†ç¯å€’è®¡æ—¶
function startLoading(){
  document.getElementById("lock").classList.add("hidden");
  const loading = document.getElementById("loading");
  loading.classList.remove("hidden");

  const canvas = document.getElementById("circleCountdown");
  const ctx = canvas.getContext("2d");
  const numberSpan = document.getElementById("countNumber");

  let totalTime = 3; // ç§’
  let start = null;

  function drawCircle(progress){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const center = canvas.width/2;
    const radius = center - 8;
    ctx.lineWidth = 8;
    // èƒŒæ™¯åœ†
    ctx.beginPath();
    ctx.strokeStyle = '#334155';
    ctx.arc(center, center, radius, 0, 2*Math.PI);
    ctx.stroke();
    // å‰æ™¯åœ†
    ctx.beginPath();
    ctx.strokeStyle = '#38bdf8';
    ctx.arc(center, center, radius, -Math.PI/2, -Math.PI/2 + 2*Math.PI*progress);
    ctx.stroke();
  }

  function step(timestamp){
    if(!start) start = timestamp;
    const elapsed = (timestamp - start)/1000; // ç§’
    let progress = Math.max(0, 1 - elapsed/totalTime);
    drawCircle(progress);
    let remaining = Math.ceil(totalTime - elapsed);
    numberSpan.innerText = remaining>0 ? remaining : 0;
    if(elapsed < totalTime){
      requestAnimationFrame(step);
    } else {
      loading.classList.add("hidden");
      openApp();
    }
  }
  requestAnimationFrame(step);
}

function openApp(){
  document.getElementById("app").classList.remove("hidden");
  renderAssets();
  updateTotals();
}

// ------------------ èµ„äº§é€»è¾‘ ------------------
function save(){ localStorage.setItem("assets",JSON.stringify(assets)); updateTotals(); }
function addCustomAsset(){ assets.push({name:"è‡ªå®šä¹‰èµ„äº§",value:0,fixed:false}); save(); renderAssets(); }
function removeAsset(i){ if(!assets[i].fixed){ assets.splice(i,1); save(); renderAssets(); } }
function setVal(i,v){ assets[i].value=parseFloat(v)||0; save(); }

function renderAssets(){
  let html="";
  assets.forEach((a,i)=>{
    html+=`<div class="row">
      <span>${a.name} ${a.fixed?"":"ğŸ’¡"}</span>
      <span>
        <input type="number" step="0.01" value="${Number(a.value).toFixed(2)}"
          oninput="setVal(${i},this.value)">
        ${a.fixed?"":"<button onclick='removeAsset(${i})'>ï¼</button>"}
      </span>
    </div>`;
  });
  document.getElementById("assets").innerHTML = html;
}

function updateTotals(){
  let totalAll=0, fund=0, stock=0;
  assets.forEach(a=>{
    totalAll += a.value||0;
    if(a.name==="å…¬ç§¯é‡‘") fund += a.value||0;
    if(a.name==="å…¬å¸è‚¡ç¥¨") stock += a.value||0;
  });

  const totalNoFundStock = totalAll - fund - stock;

  document.getElementById("totalAll").innerText = totalAll.toFixed(2);
  document.getElementById("totalNoFundStock").innerText = totalNoFundStock.toFixed(2);

  const riskYears = totalNoFundStock / 199000;
  const years = Math.floor(riskYears);
  const months = Math.floor((riskYears - years)*12);
  document.getElementById("risk").innerText = `å¯æ”¯æ’‘ ${years} å¹´ ${months} ä¸ªæœˆæ— æ”¶å…¥ç”Ÿå­˜`;

  const levels = [
    {level:"A4",amount:1e3},{level:"A5",amount:1e4},{level:"A6",amount:1e5},{level:"A6.5",amount:5e5},
    {level:"A7",amount:1e6},{level:"A7.5",amount:5e6},{level:"A8",amount:1e7},{level:"A8.5",amount:5e7},
    {level:"A9",amount:1e8},{level:"A10",amount:1e9},{level:"A11",amount:1e10}
  ];
  let currentLevel = levels[0].level;
  let nextLevelAmount = 0;
  for(let i=levels.length-1;i>=0;i--){
    if(totalAll >= levels[i].amount){
      currentLevel = levels[i].level;
      nextLevelAmount = levels[i+1]?levels[i+1].amount:levels[i].amount;
      break;
    }
  }
  document.getElementById("level").innerText = `ç­‰çº§ï¼š${currentLevel}`;
  document.getElementById("levelBar").style.width = Math.min(totalAll/1e10*100,100)+"%";

  const gapPercent = nextLevelAmount? Math.min((totalAll/nextLevelAmount)*100,100):0;
  const gapBar = document.getElementById("levelGapBar");
  gapBar.style.width = gapPercent+"%";
  document.getElementById("levelGap").innerText = nextLevelAmount ? `è·ä¸‹ä¸€çº§ï¼š${(nextLevelAmount-totalAll).toFixed(2)}` : "";

  let advice="ç»“æ„ç¨³å¥ã€‚";
  const stockValue = assets.filter(a=>["å¹³å®‰è¯åˆ¸","ä¸œæ–¹è´¢å¯Œ"].includes(a.name)).reduce((sum,a)=>sum+a.value,0);
  if(totalAll>0){
    const stockPct = stockValue/totalAll;
    if(stockPct>=0.5) advice="è‚¡ç¥¨ç±»èµ„äº§å æ¯”è¶…è¿‡ 50%ï¼Œç»“æ„æ³¢åŠ¨æ€§å¾ˆé«˜ï¼Œéœ€é«˜åº¦è­¦æƒ•å¸‚åœºå›æ’¤é£é™©ã€‚";
    else if(stockPct>=0.3) advice="è‚¡ç¥¨ç±»èµ„äº§å æ¯”è¶…è¿‡ 30%ï¼Œå·²æ˜æ˜¾å—è‚¡å¸‚å½±å“ï¼Œå»ºè®®å…³æ³¨å›æ’¤ä¸åˆ†æ•£é…ç½®ã€‚";
    else if(stockPct>=0.2) advice="è‚¡ç¥¨ç±»èµ„äº§å æ¯”è¶…è¿‡ 20%ï¼Œéœ€å¼€å§‹ç•™æ„å¸‚åœºæ³¢åŠ¨å¯¹æ•´ä½“èµ„äº§çš„å½±å“ã€‚";
  }
  document.getElementById("advice").innerText = advice;

  renderChart();
}

function renderChart(){
  const groupData = [
    assets.filter(a=>["æ”¯ä»˜å®","äº‘é—ªä»˜","ç¾å…ƒå¤–æ±‡"].includes(a.name)).reduce((sum,a)=>sum+a.value,0),
    assets.filter(a=>["å¹³å®‰è¯åˆ¸","ä¸œæ–¹è´¢å¯Œ"].includes(a.name)).reduce((sum,a)=>sum+a.value,0),
    assets.filter(a=>["å…¬ç§¯é‡‘"].includes(a.name)).reduce((sum,a=>sum+a.value,0),
    assets.filter(a=>["å…¬å¸è‚¡ç¥¨"].includes(a.name)).reduce((sum,a)=>sum+a.value,0)
  ];
  const total = groupData.reduce((a,b)=>a+b,0);
  const ctx = document.getElementById("assetChart").getContext("2d");
  if(assetChart) assetChart.destroy();
  assetChart = new Chart(ctx,{
    type:"pie",
    data:{
      labels:[
        "æ”¯ä»˜å®ã€äº‘é—ªä»˜ã€ç¾å…ƒå¤–æ±‡",
        "å¹³å®‰è¯åˆ¸ã€ä¸œæ–¹è´¢å¯Œ",
        "å…¬ç§¯é‡‘",
        "å…¬å¸è‚¡ç¥¨"
      ],
      datasets:[{data:groupData, backgroundColor:["#38bdf8","#22c55e","#facc15","#f87171"]}]
    },
    options:{
      plugins:{
        legend:{position:"bottom",labels:{color:"#e5e7eb"}},
        tooltip:{callbacks:{label:function(context){
          const pct = total>0 ? (context.raw/total*100).toFixed(1) : 0;
          return `${context.label}: ${context.raw.toFixed(2)} (${pct}%)`;
        }}}
      }
    }
  });
}
</script>
</body>
</html>
